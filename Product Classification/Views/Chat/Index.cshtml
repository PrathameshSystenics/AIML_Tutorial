@{
    ViewData["Title"] = "Chat";
}
@model ChatViewModel
<div class="container-fluid bg-light" style="min-height: calc(105vh - 150px);">
    <div class="d-flex flex-column">

        <!-- Model Selection Area -->
        <div class="p-3 border-bottom border-2 border-primary">
            <div class="d-flex flex-wrap gap-2 justify-content-between">

                <div class="d-flex align-items-center">
                    <label for="modelSelect" class="me-2 fw-bold">Select Model:</label>
                    <select id="modelSelect" name="modelSelect" class="form-select" asp-items="Model.Models" style="max-width: 200px;">
                    </select>
                </div>
                <div>
                    <a type="button" class="btn btn-dark" id="newchat-btn" asp-action="Index" asp-controller="Chat">
                        <span>
                            New Chat
                        </span>
                        <i class="bi bi-plus"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Chat Messages Area (scrollable) -->
        <div class="flex-grow-1 overflow-auto p-3" id="message-area" style="height:65vh;">
        </div>

        <!-- Example Suggestions Toggle button-->
        <div class="d-md-none mb-2">
            <button class="btn btn-sm btn-outline-secondary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#exampleSuggestions" aria-expanded="false" aria-controls="exampleSuggestions">
                <i class="bi bi-lightbulb"></i> Show examples
            </button>
        </div>

        <!-- Example suggestions component (auto-collapsed on mobile) -->
        <div class="bg-light rounded collapse d-md-block mt-2" id="exampleSuggestions">
            <div class="text-secondary mb-2 small">
                <i class="bi bi-lightbulb"></i> Suggested examples (click to apply):
            </div>
            <div class="d-flex flex-wrap">
                @foreach (string example in Model.SuggestedExamples)
                {
                    <span class="badge bg-light text-dark border me-2 mb-2 py-2 px-3 example-badge" role="button" data-example='@example' title="@example">@example</span>
                }
            </div>
        </div>


        <!--Message Input Area-->
        <div class="p-3 bg-white border-top">
            <div class="position-relative">
                <textarea class="form-control chat-textarea" placeholder="Enter Your Message..." rows="2" style="resize: none; padding-right: 50px;"></textarea>
                <button class="btn btn-primary rounded-circle position-absolute" id="chat-button" style="bottom: 8px; right: 8px;" type="button">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
            <div class="text-center mt-2">
                <small class="text-muted">
                    <i class="bi bi-info-circle"></i>
                    Product Bot can make mistakes. Consider checking important information.
                </small>
            </div>
        </div>
    </div>
</div>

<!--Model Selection Change Warning Modal-->
<div class="modal fade" id="modelChangeWarningModal" tabindex="-1" aria-labelledby="modelChangeWarningModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="modelChangeWarningModalLabel">Warning</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Changing the current model will erase your chat session. Do you wish to proceed?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmModelChange">Yes, Proceed</button>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/lib/marked/marked.min.js"></script>
    <script src="~/js/PostEventSource.js"></script>
    <script src="~/js/Chat.js"></script>
}